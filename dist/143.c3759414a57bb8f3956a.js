"use strict";(self.webpackChunkknowledgebuilder=self.webpackChunkknowledgebuilder||[]).push([[143],{4143:(Ve,G,s)=>{s.r(G),s.d(G,{HabitBuilderModule:()=>Ge});var A=s(8583),n=s(3679),H=s(4043),mt=s(6721),pt=s(558),B=s(7822),I=s(3423),t=s(7716),M=s(9692),y=s(1494),dt=s(6738),q=s.n(dt),$=s(6682),E=s(5917),V=s(9761),j=s(3190),z=s(8939),X=s(8002),K=s(5304),c=s(3186),b=s(984),x=s(2238),R=s(2522),D=s(1095),Y=s(1436),Q=s(6627),u=s(2091);function gt(e,i){1&e&&(t.TgZ(0,"th",18),t._uU(1,"#"),t.qZA())}function Ct(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"td",19),t._uU(1),t.TgZ(2,"button",1),t.NdJ("click",function(){const l=t.CHM(o).$implicit;return t.oxw().onDisplayHabit(l.ID)}),t.ALo(3,"transloco"),t.TgZ(4,"mat-icon"),t._uU(5,"launch"),t.qZA(),t.qZA(),t.TgZ(6,"button",20),t.NdJ("click",function(){const l=t.CHM(o).$implicit;return t.oxw().onDeleteHabit(l.ID)}),t.ALo(7,"transloco"),t.TgZ(8,"mat-icon"),t._uU(9,"remove_circle"),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=i.$implicit;t.xp6(1),t.hij("",o.ID," | "),t.xp6(1),t.s9C("matTooltip",t.lcZ(3,3,"Common.Display")),t.xp6(4),t.s9C("matTooltip",t.lcZ(7,5,"Common.Delete"))}}function ht(e,i){1&e&&(t.TgZ(0,"th",18),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Award.TargetUser")))}function ft(e,i){if(1&e&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.AsE("",a.getUserDisplayAs(o.targetUser)," (",o.targetUser,")")}}function Zt(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Name")))}function _t(e,i){if(1&e&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.name)}}function bt(e,i){1&e&&(t.TgZ(0,"th",18),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Type")))}function Tt(e,i){if(1&e&&(t.TgZ(0,"td",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,a.getHabitCategoryName(o.category)))}}function At(e,i){1&e&&(t.TgZ(0,"th",18),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Habit.Frequency")))}function qt(e,i){if(1&e&&(t.TgZ(0,"td",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,a.getHabitFrequencyName(o.frequency)))}}function vt(e,i){1&e&&(t.TgZ(0,"th",18),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Habit.CompleteCategory")))}function Ut(e,i){if(1&e&&(t.TgZ(0,"td",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,a.getHabitCompleteCategoryName(o.completeCategory)))}}function Ht(e,i){1&e&&(t.TgZ(0,"th",18),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Award.Validity")))}function xt(e,i){if(1&e&&(t.TgZ(0,"td",19),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.validity)}}function Dt(e,i){1&e&&t._UZ(0,"tr",22)}function yt(e,i){1&e&&t._UZ(0,"tr",23)}let W=(()=>{class e{constructor(o,a,r){this.odataSrv=o,this.dialog=a,this.uiUtilSrv=r,this.dataSource=[],this.displayedColumns=["id","targetUser","name","category","frequency","compCategory","validity"],this.recordCount=0,this.isLoadingResults=!1,this.refreshEvent=new t.vpe}ngOnInit(){this.refreshList()}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,$.T)(this.sort.sortChange,this.paginator.page,this.refreshEvent).pipe((0,V.O)({}),(0,j.w)(()=>{const o=this.paginator.pageSize,a=o*this.paginator.pageIndex;let r=q()().format(c.Jt);return this.odataSrv.getUserHabits(o,a,this.sort.active,this.sort.direction,`ValidFrom le ${r} and ValidTo ge ${r}`)}),(0,z.x)(()=>this.isLoadingResults=!1),(0,X.U)(o=>(this.recordCount=o.totalCount,o.items)),(0,K.K)(()=>(0,E.of)([]))).subscribe({next:o=>this.dataSource=o,error:o=>this.uiUtilSrv.showSnackInfo(o)})}getHabitCategoryName(o){return(0,c.xk)(o)}getHabitCompleteCategoryName(o){return(0,c.E0)(o)}getHabitFrequencyName(o){return(0,c.lC)(o)}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}onCreateHabit(){this.uiUtilSrv.navigateHabitCreatePage()}resetPaging(){this.paginator.pageIndex=0}refreshList(){this.refreshEvent.emit()}onDeleteHabit(o){this.odataSrv.deleteUserHabit(o).subscribe({next:a=>{this.refreshList()},error:a=>{this.uiUtilSrv.showSnackInfo(a)}})}onDisplayHabit(o){this.uiUtilSrv.navigateHabitDisplayPage(o)}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(b.CB),t.Y36(x.uw),t.Y36(b.dM))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-list"]],viewQuery:function(o,a){if(1&o&&(t.Gf(M.NW,5),t.Gf(y.YE,5)),2&o){let r;t.iGM(r=t.CRH())&&(a.paginator=r.first),t.iGM(r=t.CRH())&&(a.sort=r.first)}},decls:36,vars:11,consts:[[1,"toolbar-spacer"],["mat-icon-button","","color","primary",3,"matTooltip","click"],[1,"example-container","mat-elevation-z8"],[1,"table-container"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource","matSortChange"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","targetUser"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","category"],["matColumnDef","frequency"],["matColumnDef","compCategory"],["matColumnDef","validity"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"length","pageSize"],["mat-header-cell",""],["mat-cell",""],["mat-icon-button","","color","warn",3,"matTooltip","click"],["mat-header-cell","","mat-sort-header",""],["mat-header-row",""],["mat-row",""]],template:function(o,a){1&o&&(t.TgZ(0,"mat-toolbar"),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"div",0),t.TgZ(5,"button",1),t.NdJ("click",function(){return a.onCreateHabit()}),t.ALo(6,"transloco"),t.TgZ(7,"mat-icon"),t._uU(8,"add_circle"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",2),t.TgZ(10,"div",3),t.TgZ(11,"table",4),t.NdJ("matSortChange",function(){return a.resetPaging()}),t.ynx(12,5),t.YNc(13,gt,2,0,"th",6),t.YNc(14,Ct,10,7,"td",7),t.BQk(),t.ynx(15,8),t.YNc(16,ht,3,3,"th",6),t.YNc(17,ft,2,2,"td",7),t.BQk(),t.ynx(18,9),t.YNc(19,Zt,3,3,"th",10),t.YNc(20,_t,2,1,"td",7),t.BQk(),t.ynx(21,11),t.YNc(22,bt,3,3,"th",6),t.YNc(23,Tt,3,3,"td",7),t.BQk(),t.ynx(24,12),t.YNc(25,At,3,3,"th",6),t.YNc(26,qt,3,3,"td",7),t.BQk(),t.ynx(27,13),t.YNc(28,vt,3,3,"th",6),t.YNc(29,Ut,3,3,"td",7),t.BQk(),t.ynx(30,14),t.YNc(31,Ht,3,3,"th",6),t.YNc(32,xt,2,1,"td",7),t.BQk(),t.YNc(33,Dt,1,0,"tr",15),t.YNc(34,yt,1,0,"tr",16),t.qZA(),t.qZA(),t._UZ(35,"mat-paginator",17),t.qZA()),2&o&&(t.xp6(2),t.Oqu(t.lcZ(3,7,"Habit.Habits")),t.xp6(3),t.s9C("matTooltip",t.lcZ(6,9,"Common.Create")),t.xp6(6),t.Q6J("dataSource",a.dataSource),t.xp6(22),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(1),t.Q6J("length",a.recordCount)("pageSize",20))},directives:[R.Ye,D.lW,Y.gM,Q.Hw,u.BZ,y.YE,u.w1,u.fO,u.Dz,u.as,u.nj,M.NW,u.ge,u.ev,y.nU,u.XQ,u.Gk],pipes:[H.Ot],styles:[".example-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.table-container[_ngcontent-%COMP%]{position:relative;min-height:400px;overflow:auto}table[_ngcontent-%COMP%]{width:100%;height:100%}"]}),e})();var f=s(2937),T=s(3738),C=s(8295),O=s(7441),k=s(9983),h=s(3220),N=s(2458);function Ot(e,i){if(1&e&&(t.TgZ(0,"mat-option",17),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.targetUser),t.xp6(1),t.Oqu(o.displayAs)}}function Nt(e,i){if(1&e&&(t.TgZ(0,"mat-option",17),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.value),t.xp6(1),t.Oqu(t.lcZ(2,2,o.i18nterm))}}function wt(e,i){if(1&e&&(t.TgZ(0,"mat-option",17),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.value),t.xp6(1),t.hij("",t.lcZ(2,2,o.i18nterm)," ")}}let tt=(()=>{class e{constructor(o,a,r,l){this.activateRoute=o,this._formBuilder=a,this.uiUtilSrv=r,this.odataSrv=l,this.routerID=-1,this.uiMode=f.sk.Display,this.currentMode="Common.Display",this.arCategories=[],this.arFrequencies=[],this.arCompleteCategories=[],this.currentObject=null,this.arCategories=(0,c.ZP)(),this.arFrequencies=(0,c.AX)(),this.arCompleteCategories=(0,c.nX)(),this.detailFormGroup=this._formBuilder.group({targetuserCtrl:["",n.kI.required],nameCtrl:["",n.kI.required],ctgyCtrl:[c.cb.Positive,n.kI.required],validFromCtrl:[void 0,n.kI.required],validToCtrl:[void 0,n.kI.required],freqCtrl:[c.Hs.Daily,n.kI.required],compCtgyCtrl:[c.Kd.NumberOfTimes,n.kI.required],compCondCtrl:[0],startDateCtrl:[void 0]})}get arTargetUsers(){return this.odataSrv.currentUserDetail?this.odataSrv.currentUserDetail.awardUsers:[]}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}get isDisplayMode(){return this.uiMode===f.sk.Display}get isUpdateMode(){return this.uiMode===f.sk.Update}get isEditable(){return this.uiMode===f.sk.Update}ngOnInit(){this.activateRoute.url.subscribe({next:o=>{o instanceof Array&&o.length>0&&("display"===o[0].path?(this.uiMode=f.sk.Display,this.currentMode="Common.Display",this.routerID=+o[1].path):"edit"===o[0].path&&(this.uiMode=f.sk.Update,this.currentMode="Common.Change",this.routerID=+o[1].path)),-1!==this.routerID&&this.odataSrv.readUserHabit(this.routerID).subscribe({next:a=>{var r,l,p,d,m,Z,_,U;this.currentObject=a,null===(r=this.detailFormGroup.get("targetuserCtrl"))||void 0===r||r.setValue(this.currentObject.targetUser),null===(l=this.detailFormGroup.get("nameCtrl"))||void 0===l||l.setValue(this.currentObject.name),null===(p=this.detailFormGroup.get("validFromCtrl"))||void 0===p||p.setValue(this.currentObject.validFrom),null===(d=this.detailFormGroup.get("validToCtrl"))||void 0===d||d.setValue(this.currentObject.validTo),null===(m=this.detailFormGroup.get("freqCtrl"))||void 0===m||m.setValue(this.currentObject.frequency),null===(Z=this.detailFormGroup.get("compCtgyCtrl"))||void 0===Z||Z.setValue(this.currentObject.completeCategory),null===(_=this.detailFormGroup.get("compCondCtrl"))||void 0===_||_.setValue(this.currentObject.completeCondition),null===(U=this.detailFormGroup.get("startDateCtrl"))||void 0===U||U.setValue(this.currentObject.startDate),this.uiMode===f.sk.Display?this.detailFormGroup.disable():(this.detailFormGroup.enable(),this.detailFormGroup.markAsPristine())},error:a=>{}})},error:o=>{this.uiUtilSrv.showSnackInfo(o)}})}onSave(){}onBackToList(){this.uiUtilSrv.navigateHabitListPage()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(I.gz),t.Y36(n.qu),t.Y36(b.dM),t.Y36(b.CB))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-detail"]],decls:70,vars:46,consts:[[3,"formGroup"],["appearance","fill",1,"control-full-width"],["required","","formControlName","targetuserCtrl"],[3,"value",4,"ngFor","ngForOf"],["matInput","","required","","formControlName","nameCtrl"],["appearance","fill"],[3,"rangePicker"],["matStartDate","","formControlName","validFromCtrl","placeholder","Start date"],["matEndDate","","formControlName","validToCtrl","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],["required","","formControlName","freqCtrl"],["required","","formControlName","compCtgyCtrl"],["matInput","","required","","type","number","formControlName","compCondCtrl"],["matInput","","required","","type","number","formControlName","startDateCtrl"],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"],[3,"value"]],template:function(o,a){if(1&o&&(t.TgZ(0,"mat-card"),t.TgZ(1,"mat-card-header"),t.TgZ(2,"mat-card-title"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-card-subtitle"),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.qZA(),t.TgZ(8,"mat-card-content"),t.TgZ(9,"form",0),t.TgZ(10,"mat-form-field",1),t.TgZ(11,"mat-label"),t._uU(12),t.ALo(13,"transloco"),t.qZA(),t.TgZ(14,"mat-select",2),t.YNc(15,Ot,2,2,"mat-option",3),t.qZA(),t.qZA(),t.TgZ(16,"mat-form-field",1),t.TgZ(17,"mat-label"),t._uU(18),t.ALo(19,"transloco"),t.qZA(),t._UZ(20,"input",4),t.qZA(),t.TgZ(21,"mat-form-field",5),t.TgZ(22,"mat-label"),t._uU(23),t.ALo(24,"transloco"),t.qZA(),t.TgZ(25,"mat-date-range-input",6),t._UZ(26,"input",7),t._UZ(27,"input",8),t.qZA(),t._UZ(28,"mat-datepicker-toggle",9),t._UZ(29,"mat-date-range-picker",null,10),t.qZA(),t.TgZ(31,"mat-form-field",1),t.TgZ(32,"mat-label"),t._uU(33),t.ALo(34,"transloco"),t.qZA(),t.TgZ(35,"mat-select",11),t.YNc(36,Nt,3,4,"mat-option",3),t.qZA(),t.TgZ(37,"mat-hint"),t._uU(38),t.ALo(39,"transloco"),t.qZA(),t.qZA(),t.TgZ(40,"mat-form-field",1),t.TgZ(41,"mat-label"),t._uU(42),t.ALo(43,"transloco"),t.qZA(),t.TgZ(44,"mat-select",12),t.YNc(45,wt,3,4,"mat-option",3),t.qZA(),t.TgZ(46,"mat-hint"),t._uU(47),t.ALo(48,"transloco"),t.qZA(),t.qZA(),t.TgZ(49,"mat-form-field",1),t.TgZ(50,"mat-label"),t._uU(51),t.ALo(52,"transloco"),t.qZA(),t._UZ(53,"input",13),t.TgZ(54,"mat-hint"),t._uU(55),t.ALo(56,"transloco"),t.qZA(),t.qZA(),t.TgZ(57,"mat-form-field",1),t.TgZ(58,"mat-label"),t._uU(59),t.ALo(60,"transloco"),t.qZA(),t._UZ(61,"input",14),t.TgZ(62,"mat-hint"),t._uU(63),t.ALo(64,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(65,"mat-card-actions"),t.TgZ(66,"button",15),t.NdJ("click",function(){return a.onSave()}),t._uU(67,"SAVE"),t.qZA(),t.TgZ(68,"button",16),t.NdJ("click",function(){return a.onBackToList()}),t._uU(69,"BACK TO LIST"),t.qZA(),t.qZA(),t.qZA()),2&o){const r=t.MAs(30);t.xp6(3),t.Oqu(t.lcZ(4,20,"Habit.Habit")),t.xp6(3),t.Oqu(t.lcZ(7,22,a.currentMode)),t.xp6(3),t.Q6J("formGroup",a.detailFormGroup),t.xp6(3),t.Oqu(t.lcZ(13,24,"Award.TargetUser")),t.xp6(3),t.Q6J("ngForOf",a.arTargetUsers),t.xp6(3),t.Oqu(t.lcZ(19,26,"Common.Name")),t.xp6(5),t.Oqu(t.lcZ(24,28,"Award.Validity")),t.xp6(2),t.Q6J("rangePicker",r),t.xp6(3),t.Q6J("for",r),t.xp6(5),t.Oqu(t.lcZ(34,30,"Habit.Frequency")),t.xp6(3),t.Q6J("ngForOf",a.arFrequencies),t.xp6(2),t.Oqu(t.lcZ(39,32,"Habit.FrequencyHint")),t.xp6(4),t.Oqu(t.lcZ(43,34,"Habit.CompleteCategory")),t.xp6(3),t.Q6J("ngForOf",a.arCompleteCategories),t.xp6(2),t.Oqu(t.lcZ(48,36,"Habit.CompleteCategoryHint")),t.xp6(4),t.Oqu(t.lcZ(52,38,"Habit.CompleteCondition")),t.xp6(4),t.Oqu(t.lcZ(56,40,"Habit.CompleteConditionHint")),t.xp6(4),t.Oqu(t.lcZ(60,42,"Habit.StartDate")),t.xp6(4),t.Oqu(t.lcZ(64,44,"Habit.StartDateHint")),t.xp6(3),t.Q6J("disabled",a.isDisplayMode)}},directives:[T.a8,T.dk,T.n5,T.$j,T.dn,n._Y,n.JL,n.sg,C.KE,C.hX,O.gD,n.Q7,n.JJ,n.u,A.sg,k.Nt,n.Fj,h.wx,h.zY,h.By,h.nW,C.R9,h._g,C.bx,n.wV,T.hq,D.lW,N.ey],pipes:[H.Ot],styles:[""]}),e})();var v=s(4553),et=s(7746);function St(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Habit.Habit"))}function Lt(e,i){if(1&e&&(t.TgZ(0,"mat-option",38),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.targetUser),t.xp6(1),t.Oqu(o.displayAs)}}function Rt(e,i){if(1&e&&(t.TgZ(0,"mat-option",38),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.value),t.xp6(1),t.Oqu(t.lcZ(2,2,o.i18nterm))}}function kt(e,i){if(1&e&&(t.TgZ(0,"mat-option",38),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.value),t.xp6(1),t.hij("",t.lcZ(2,2,o.i18nterm)," ")}}function Ft(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Award.ContinuousDays"))}function It(e,i){if(1&e&&(t.TgZ(0,"mat-list",39),t.TgZ(1,"mat-list-item"),t._uU(2),t.qZA(),t.qZA()),2&e){const o=i.$implicit;t.xp6(2),t.Oqu(o.toString())}}function Mt(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Award.Point"))}function Jt(e,i){1&e&&(t.TgZ(0,"th",40),t._uU(1,"ID"),t.qZA())}function Yt(e,i){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.ruleID)}}function Qt(e,i){1&e&&(t.TgZ(0,"th",40),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Award.ContinuousDays")))}function Pt(e,i){if(1&e&&(t.TgZ(0,"td",41),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.continuousDays)}}function Gt(e,i){1&e&&(t.TgZ(0,"th",40),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Award.Point")))}function Bt(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"td",41),t.TgZ(1,"mat-form-field",42),t.TgZ(2,"input",43),t.NdJ("ngModelChange",function(r){return t.CHM(o).$implicit.point=r})("ngModelChange",function(r){return t.CHM(o),t.oxw().onPointCellChanged(r)}),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=i.$implicit;t.xp6(2),t.Q6J("ngModel",o.point)}}function $t(e,i){1&e&&t._UZ(0,"tr",44)}function Et(e,i){1&e&&t._UZ(0,"tr",45)}function Vt(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Common.Done"))}class ot{constructor(){this.from=0,this.to=0}toString(){return`[${this.from} - ${this.to})`}}const at=e=>{var i,o,a,r,l,p,d,m,Z,_,U,F,w,S,L;const g=new c.ke;switch(g.category=c.cb.Positive,g.targetUser=null===(i=e.get("targetuserCtrl"))||void 0===i?void 0:i.value,g.validFrom=q()(null===(o=e.get("validFromCtrl"))||void 0===o?void 0:o.value),g.validTo=q()(null===(a=e.get("validToCtrl"))||void 0===a?void 0:a.value),g.name=null===(r=e.get("nameCtrl"))||void 0===r?void 0:r.value,g.frequency=null===(l=e.get("freqCtrl"))||void 0===l?void 0:l.value,g.completeCategory=null===(p=e.get("compCtgyCtrl"))||void 0===p?void 0:p.value,g.frequency){case c.Hs.Weekly:switch(g.completeCategory){case c.Kd.NumberOfCount:g.startDate=null===(d=e.get("startDateCtrl"))||void 0===d?void 0:d.value,g.completeCondition=null===(m=e.get("compCondCtrl"))||void 0===m?void 0:m.value;break;case c.Kd.NumberOfTimes:default:g.startDate=null===(Z=e.get("startDateCtrl"))||void 0===Z?void 0:Z.value,g.completeCondition=null===(_=e.get("compCondCtrl"))||void 0===_?void 0:_.value}break;case c.Hs.Monthly:switch(g.completeCategory){case c.Kd.NumberOfCount:g.startDate=null===(U=e.get("startDateCtrl"))||void 0===U?void 0:U.value,g.completeCondition=null===(F=e.get("compCondCtrl"))||void 0===F?void 0:F.value;break;case c.Kd.NumberOfTimes:default:g.startDate=null===(w=e.get("startDateCtrl"))||void 0===w?void 0:w.value,g.completeCondition=null===(S=e.get("compCondCtrl"))||void 0===S?void 0:S.value}break;case c.Hs.Daily:default:switch(g.completeCategory){case c.Kd.NumberOfCount:g.startDate=void 0,g.completeCondition=null===(L=e.get("compCondCtrl"))||void 0===L?void 0:L.value;break;case c.Kd.NumberOfTimes:default:g.startDate=void 0,g.completeCondition=1}}return g},jt=e=>at(e).isValid?null:{invalidInputs:!0};let zt=(()=>{class e{constructor(o,a,r){this._formBuilder=o,this.uiUtilSrv=a,this.odataSrv=r,this.arRuleTypes=[],this.contDays=[],this.arRules=[],this.displayedColumns=["ruleID","continuousDays","point"],this.pointCompleted=!1,this.createdHabitID=-1,this.arCategories=[],this.arFrequencies=[],this.arCompleteCategories=[],this.arCategories=(0,c.ZP)(),this.arFrequencies=(0,c.AX)(),this.arCompleteCategories=(0,c.nX)(),this.currentObject=new c.ke,this.firstFormGroup=this._formBuilder.group({targetuserCtrl:new n.NI(""),nameCtrl:new n.NI("",n.kI.required),validFromCtrl:new n.NI(q()(),n.kI.required),validToCtrl:new n.NI(q()(),n.kI.required),freqCtrl:new n.NI(c.Hs.Weekly,n.kI.required),compCtgyCtrl:new n.NI(c.Kd.NumberOfTimes,n.kI.required),compCondCtrl:new n.NI,startDateCtrl:new n.NI},{validators:jt}),this.secondFormGroup=this._formBuilder.group({rawCtrl:new n.NI("",n.kI.required)})}get arTargetUsers(){return this.odataSrv.currentUserDetail?this.odataSrv.currentUserDetail.awardUsers:[]}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}ngOnInit(){var o,a,r;null===(o=this.firstFormGroup.get("freqCtrl"))||void 0===o||o.valueChanges.subscribe(l=>{this.onFreqencyAndCompleteCategoryChange(l)}),null===(a=this.firstFormGroup.get("compCtgyCtrl"))||void 0===a||a.valueChanges.subscribe(l=>{this.onFreqencyAndCompleteCategoryChange(l)}),null===(r=this.secondFormGroup.get("rawCtrl"))||void 0===r||r.valueChanges.subscribe(l=>{this.onContDayChange(l)})}onFreqencyAndCompleteCategoryChange(o){var a,r,l,p,d,m,Z;const _=null===(a=this.firstFormGroup.get("compCtgyCtrl"))||void 0===a?void 0:a.value;(null===(r=this.firstFormGroup.get("freqCtrl"))||void 0===r?void 0:r.value)===c.Hs.Daily?(_===c.Kd.NumberOfTimes?null===(l=this.firstFormGroup.get("compCondCtrl"))||void 0===l||l.disable():null===(p=this.firstFormGroup.get("compCondCtrl"))||void 0===p||p.enable(),null===(d=this.firstFormGroup.get("startDateCtrl"))||void 0===d||d.disable()):(null===(m=this.firstFormGroup.get("compCondCtrl"))||void 0===m||m.enable(),null===(Z=this.firstFormGroup.get("startDateCtrl"))||void 0===Z||Z.enable())}onContDayChange(o){if(this.contDays=[],o){let r=o.split(";").map(d=>{if(d){const m=+d;if(!isNaN(m)&&m>0)return Math.trunc(m)}return 0});r=r.filter(d=>d>0),r.sort();let l=0;r.forEach(d=>{if(0!==l){const m=new ot;m.from=l,m.to=d,this.contDays.push(m)}l=d});const p=new ot;p.from=l,p.to=9999,this.contDays.push(p)}}onPointCellChanged(o){let a=0;this.arRules.forEach(r=>{(isNaN(r.point)||0===r.point)&&a++}),this.pointCompleted=0===a}onInitialRules(){this.arRules=[],this.contDays.forEach((o,a)=>{let r=new c.hp;r.ruleID=a+1,r.continuousRecordFrom=o.from,r.continuousRecordTo=o.to,this.arRules.push(r)})}onSave(){let o=at(this.firstFormGroup);!o.isValid||(this.arRules.forEach(a=>{o.arRules.push(a)}),this.odataSrv.createUserHabit(o).subscribe({next:a=>{a&&a.ID&&(this.createdHabitID=a.ID)},error:a=>{this.uiUtilSrv.showSnackInfo(a,1e3)}}))}onGoToList(){this.uiUtilSrv.navigateHabitListPage()}onDisplayHabit(){this.createdHabitID&&this.uiUtilSrv.navigateHabitDisplayPage(this.createdHabitID)}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(n.qu),t.Y36(b.dM),t.Y36(b.CB))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-create"]],decls:126,vars:86,consts:[[1,"toolbar-spacer"],["linear",""],["stepper",""],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],["appearance","fill",1,"control-full-width"],["formControlName","targetuserCtrl"],[3,"value",4,"ngFor","ngForOf"],["matInput","","required","","formControlName","nameCtrl"],["appearance","fill"],[3,"rangePicker"],["matStartDate","","formControlName","validFromCtrl","placeholder","Start date"],["matEndDate","","formControlName","validToCtrl","placeholder","End date"],["matSuffix","",3,"for"],["picker",""],["required","","formControlName","freqCtrl"],["required","","formControlName","compCtgyCtrl"],["matInput","","type","number","formControlName","compCondCtrl"],["matInput","","type","number","formControlName","startDateCtrl"],["mat-button","","color","primary","matStepperNext","",3,"disabled"],["matInput","","formControlName","rawCtrl"],["dense","",4,"ngFor","ngForOf"],["mat-button","","matStepperPrevious",""],["mat-button","","color","primary","matStepperNext","",3,"click"],[3,"completed"],["mat-raised-button","","disabled",""],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","ruleID"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","continuousDays"],["matColumnDef","point"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-button","","color","primary","matStepperNext","",3,"disabled","click"],["mat-button","",3,"click"],["mat-button","","color","warn",3,"click"],[3,"value"],["dense",""],["mat-header-cell",""],["mat-cell",""],[1,"control-full-width"],["matInput","","type","number",1,"input-point",3,"ngModel","ngModelChange"],["mat-header-row",""],["mat-row",""]],template:function(o,a){if(1&o){const r=t.EpF();t.TgZ(0,"mat-toolbar"),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"div",0),t.TgZ(5,"h3"),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.qZA(),t.TgZ(8,"mat-vertical-stepper",1,2),t.TgZ(10,"mat-step",3),t.TgZ(11,"form",4),t.YNc(12,St,2,3,"ng-template",5),t.TgZ(13,"mat-form-field",6),t.TgZ(14,"mat-label"),t._uU(15),t.ALo(16,"transloco"),t.qZA(),t.TgZ(17,"mat-select",7),t.YNc(18,Lt,2,2,"mat-option",8),t.qZA(),t.qZA(),t.TgZ(19,"mat-form-field",6),t.TgZ(20,"mat-label"),t._uU(21),t.ALo(22,"transloco"),t.qZA(),t._UZ(23,"input",9),t.qZA(),t.TgZ(24,"mat-form-field",10),t.TgZ(25,"mat-label"),t._uU(26),t.ALo(27,"transloco"),t.qZA(),t.TgZ(28,"mat-date-range-input",11),t._UZ(29,"input",12),t._UZ(30,"input",13),t.qZA(),t._UZ(31,"mat-datepicker-toggle",14),t._UZ(32,"mat-date-range-picker",null,15),t.qZA(),t.TgZ(34,"mat-form-field",6),t.TgZ(35,"mat-label"),t._uU(36),t.ALo(37,"transloco"),t.qZA(),t.TgZ(38,"mat-select",16),t.YNc(39,Rt,3,4,"mat-option",8),t.qZA(),t.TgZ(40,"mat-hint"),t._uU(41),t.ALo(42,"transloco"),t.qZA(),t.qZA(),t.TgZ(43,"mat-form-field",6),t.TgZ(44,"mat-label"),t._uU(45),t.ALo(46,"transloco"),t.qZA(),t.TgZ(47,"mat-select",17),t.YNc(48,kt,3,4,"mat-option",8),t.qZA(),t.TgZ(49,"mat-hint"),t._uU(50),t.ALo(51,"transloco"),t.qZA(),t.qZA(),t.TgZ(52,"mat-form-field",6),t.TgZ(53,"mat-label"),t._uU(54),t.ALo(55,"transloco"),t.qZA(),t._UZ(56,"input",18),t.TgZ(57,"mat-hint"),t._uU(58),t.ALo(59,"transloco"),t.qZA(),t.qZA(),t.TgZ(60,"mat-form-field",6),t.TgZ(61,"mat-label"),t._uU(62),t.ALo(63,"transloco"),t.qZA(),t._UZ(64,"input",19),t.TgZ(65,"mat-hint"),t._uU(66),t.ALo(67,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(68,"div"),t.TgZ(69,"button",20),t._uU(70),t.ALo(71,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(72,"mat-step",3),t.TgZ(73,"form",4),t.YNc(74,Ft,2,3,"ng-template",5),t.TgZ(75,"mat-form-field",6),t.TgZ(76,"mat-label"),t._uU(77),t.ALo(78,"transloco"),t.qZA(),t._UZ(79,"input",21),t.qZA(),t.qZA(),t.YNc(80,It,3,1,"mat-list",22),t.TgZ(81,"div"),t.TgZ(82,"button",23),t._uU(83),t.ALo(84,"transloco"),t.qZA(),t.TgZ(85,"button",24),t.NdJ("click",function(){return a.onInitialRules()}),t._uU(86),t.ALo(87,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(88,"mat-step",25),t.YNc(89,Mt,2,3,"ng-template",5),t.TgZ(90,"mat-toolbar"),t.TgZ(91,"button",26),t._uU(92,"RESET RULES"),t.qZA(),t.qZA(),t.TgZ(93,"table",27),t.ynx(94,28),t.YNc(95,Jt,2,0,"th",29),t.YNc(96,Yt,2,1,"td",30),t.BQk(),t.ynx(97,31),t.YNc(98,Qt,3,3,"th",29),t.YNc(99,Pt,2,1,"td",30),t.BQk(),t.ynx(100,32),t.YNc(101,Gt,3,3,"th",29),t.YNc(102,Bt,3,1,"td",30),t.BQk(),t.YNc(103,$t,1,0,"tr",33),t.YNc(104,Et,1,0,"tr",34),t.qZA(),t.TgZ(105,"button",23),t._uU(106),t.ALo(107,"transloco"),t.qZA(),t.TgZ(108,"button",35),t.NdJ("click",function(){return a.onSave()}),t._uU(109),t.ALo(110,"transloco"),t.qZA(),t.qZA(),t.TgZ(111,"mat-step"),t.YNc(112,Vt,2,3,"ng-template",5),t.TgZ(113,"p"),t._uU(114),t.ALo(115,"transloco"),t.qZA(),t.TgZ(116,"p"),t._uU(117),t.ALo(118,"transloco"),t.qZA(),t.TgZ(119,"div"),t.TgZ(120,"button",36),t.NdJ("click",function(){return a.onDisplayHabit()}),t._uU(121),t.ALo(122,"transloco"),t.qZA(),t.TgZ(123,"button",37),t.NdJ("click",function(){return t.CHM(r),t.MAs(9).reset()}),t._uU(124),t.ALo(125,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const r=t.MAs(33);t.xp6(2),t.Oqu(t.lcZ(3,40,"Habit.Habit")),t.xp6(4),t.Oqu(t.lcZ(7,42,"Common.Create")),t.xp6(4),t.Q6J("stepControl",a.firstFormGroup),t.xp6(1),t.Q6J("formGroup",a.firstFormGroup),t.xp6(4),t.Oqu(t.lcZ(16,44,"Award.TargetUser")),t.xp6(3),t.Q6J("ngForOf",a.arTargetUsers),t.xp6(3),t.Oqu(t.lcZ(22,46,"Common.Name")),t.xp6(5),t.Oqu(t.lcZ(27,48,"Award.Validity")),t.xp6(2),t.Q6J("rangePicker",r),t.xp6(3),t.Q6J("for",r),t.xp6(5),t.Oqu(t.lcZ(37,50,"Habit.Frequency")),t.xp6(3),t.Q6J("ngForOf",a.arFrequencies),t.xp6(2),t.Oqu(t.lcZ(42,52,"Habit.FrequencyHint")),t.xp6(4),t.Oqu(t.lcZ(46,54,"Habit.CompleteCategory")),t.xp6(3),t.Q6J("ngForOf",a.arCompleteCategories),t.xp6(2),t.Oqu(t.lcZ(51,56,"Habit.CompleteCategoryHint")),t.xp6(4),t.Oqu(t.lcZ(55,58,"Habit.CompleteCondition")),t.xp6(4),t.Oqu(t.lcZ(59,60,"Habit.CompleteConditionHint")),t.xp6(4),t.Oqu(t.lcZ(63,62,"Habit.StartDate")),t.xp6(4),t.Oqu(t.lcZ(67,64,"Habit.StartDateHint")),t.xp6(3),t.Q6J("disabled",!a.firstFormGroup.valid),t.xp6(1),t.Oqu(t.lcZ(71,66,"Common.Next")),t.xp6(2),t.Q6J("stepControl",a.secondFormGroup),t.xp6(1),t.Q6J("formGroup",a.secondFormGroup),t.xp6(4),t.Oqu(t.lcZ(78,68,"Award.ContinuousDays")),t.xp6(3),t.Q6J("ngForOf",a.contDays),t.xp6(3),t.Oqu(t.lcZ(84,70,"Common.Previous")),t.xp6(3),t.Oqu(t.lcZ(87,72,"Common.Next")),t.xp6(2),t.Q6J("completed",a.pointCompleted),t.xp6(5),t.Q6J("dataSource",a.arRules),t.xp6(10),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(2),t.Oqu(t.lcZ(107,74,"Common.Previous")),t.xp6(2),t.Q6J("disabled",!a.pointCompleted),t.xp6(1),t.Oqu(t.lcZ(110,76,"Common.Next")),t.xp6(5),t.AsE("",t.lcZ(115,78,"AwardRuleGroupCreatedInfo1"),", ID: ",a.createdHabitID," "),t.xp6(3),t.Oqu(t.lcZ(118,80,"AwardRuleGroupCreatedInfo2")),t.xp6(4),t.Oqu(t.lcZ(122,82,"Common.Display")),t.xp6(3),t.Oqu(t.lcZ(125,84,"Common.CreateAnotherOne"))}},directives:[R.Ye,v.Vq,v.C0,n._Y,n.JL,n.sg,v.VY,C.KE,C.hX,O.gD,n.JJ,n.u,A.sg,k.Nt,n.Fj,n.Q7,h.wx,h.zY,h.By,h.nW,C.R9,h._g,C.bx,n.wV,D.lW,v.Ic,v.fd,u.BZ,u.w1,u.fO,u.Dz,u.as,u.nj,N.ey,et.i$,et.Tg,u.ge,u.ev,n.On,u.XQ,u.Gk],pipes:[H.Ot],styles:[".example-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.table-container[_ngcontent-%COMP%]{position:relative;min-height:400px;overflow:auto}table[_ngcontent-%COMP%]{width:100%;height:100%}.input-point[_ngcontent-%COMP%]{text-align:center}"]}),e})();function Xt(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Award.TargetUser")))}function Kt(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.AsE("",a.getUserDisplayAs(o.targetUser)," (",o.targetUser,")")}}function Wt(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Name")))}function te(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.hij(" ",o.habitName," ")}}function ee(e,i){1&e&&(t.TgZ(0,"th",21),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Quiz.Date")))}function oe(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.recordDateString)}}function ae(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1,"Sub ID"),t.qZA())}function ie(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"td",20),t._uU(1),t.TgZ(2,"button",1),t.NdJ("click",function(){const l=t.CHM(o).$implicit;return t.oxw().onDisplayRecord(l)}),t.ALo(3,"transloco"),t.TgZ(4,"mat-icon"),t._uU(5,"launch"),t.qZA(),t.qZA(),t.TgZ(6,"button",22),t.NdJ("click",function(){const l=t.CHM(o).$implicit;return t.oxw().onDeleteRecord(l)}),t.ALo(7,"transloco"),t.TgZ(8,"mat-icon"),t._uU(9,"remove_circle"),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=i.$implicit;t.xp6(1),t.hij(" ",o.subID," "),t.xp6(1),t.s9C("matTooltip",t.lcZ(3,3,"Common.Display")),t.xp6(4),t.s9C("matTooltip",t.lcZ(7,5,"Common.Delete"))}}function re(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Habit.CompleteFact")))}function ne(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.completeFact)}}function le(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1,"Rule ID"),t.qZA())}function se(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.ruleID)}}function ce(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Award.ContinuousDays")))}function ue(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.continuousCount)}}function me(e,i){1&e&&(t.TgZ(0,"th",19),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Comment")))}function pe(e,i){if(1&e&&(t.TgZ(0,"td",20),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.comment)}}function de(e,i){1&e&&t._UZ(0,"tr",23)}function ge(e,i){1&e&&t._UZ(0,"tr",24)}let it=(()=>{class e{constructor(o,a,r){this.odataSrv=o,this.dialog=a,this.uiUtilSrv=r,this.arRecords=[],this.displayedColumns=["targetUser","habitname","recordDate","subID","completeFact","ruleID","contDays","comment"],this.recordCount=0,this.isLoadingResults=!1,this.refreshEvent=new t.vpe}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}ngOnInit(){}ngAfterViewInit(){this.sort.sortChange.subscribe(()=>this.paginator.pageIndex=0),(0,$.T)(this.sort.sortChange,this.paginator.page,this.refreshEvent).pipe((0,V.O)({}),(0,j.w)(()=>{const o=this.paginator.pageSize;return this.odataSrv.getUserHabitRecordViews(o,o*this.paginator.pageIndex,this.sort.active,this.sort.direction)}),(0,z.x)(()=>this.isLoadingResults=!1),(0,X.U)(o=>(this.recordCount=o.totalCount,o.items)),(0,K.K)(()=>(0,E.of)([]))).subscribe({next:o=>this.arRecords=o,error:o=>this.uiUtilSrv.showSnackInfo(o)})}onCreateRecord(){this.uiUtilSrv.navigateHabitRecordCreatePage()}onRefreshList(){this.refreshEvent.emit()}resetPaging(){this.paginator.pageIndex=0}onDisplayRecord(o){this.uiUtilSrv.currentUserHabitRecord=o,this.uiUtilSrv.navigateHabitRecordDisplayPage()}onDeleteRecord(o){this.odataSrv.deleteUserHabitRecord(o.habitID,o.recordDateString,o.subID).subscribe({next:a=>{this.uiUtilSrv.showSnackInfo("Delete successfully")},error:a=>{this.uiUtilSrv.showSnackInfo(a)}})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(b.CB),t.Y36(x.uw),t.Y36(b.dM))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-record-list"]],viewQuery:function(o,a){if(1&o&&(t.Gf(M.NW,5),t.Gf(y.YE,5)),2&o){let r;t.iGM(r=t.CRH())&&(a.paginator=r.first),t.iGM(r=t.CRH())&&(a.sort=r.first)}},decls:39,vars:11,consts:[[1,"toolbar-spacer"],["mat-icon-button","","color","primary",3,"matTooltip","click"],[1,"example-container","mat-elevation-z8"],[1,"table-container"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource","matSortChange"],["matColumnDef","targetUser"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","habitname"],["matColumnDef","recordDate"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["matColumnDef","subID"],["matColumnDef","completeFact"],["matColumnDef","ruleID"],["matColumnDef","contDays"],["matColumnDef","comment"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"length","pageSize"],["mat-header-cell",""],["mat-cell",""],["mat-header-cell","","mat-sort-header",""],["mat-icon-button","","color","warn",3,"matTooltip","click"],["mat-header-row",""],["mat-row",""]],template:function(o,a){1&o&&(t.TgZ(0,"mat-toolbar"),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"div",0),t.TgZ(5,"button",1),t.NdJ("click",function(){return a.onCreateRecord()}),t.ALo(6,"transloco"),t.TgZ(7,"mat-icon"),t._uU(8,"add_circle"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(9,"div",2),t.TgZ(10,"div",3),t.TgZ(11,"table",4),t.NdJ("matSortChange",function(){return a.resetPaging()}),t.ynx(12,5),t.YNc(13,Xt,3,3,"th",6),t.YNc(14,Kt,2,2,"td",7),t.BQk(),t.ynx(15,8),t.YNc(16,Wt,3,3,"th",6),t.YNc(17,te,2,1,"td",7),t.BQk(),t.ynx(18,9),t.YNc(19,ee,3,3,"th",10),t.YNc(20,oe,2,1,"td",7),t.BQk(),t.ynx(21,11),t.YNc(22,ae,2,0,"th",6),t.YNc(23,ie,10,7,"td",7),t.BQk(),t.ynx(24,12),t.YNc(25,re,3,3,"th",6),t.YNc(26,ne,2,1,"td",7),t.BQk(),t.ynx(27,13),t.YNc(28,le,2,0,"th",6),t.YNc(29,se,2,1,"td",7),t.BQk(),t.ynx(30,14),t.YNc(31,ce,3,3,"th",6),t.YNc(32,ue,2,1,"td",7),t.BQk(),t.ynx(33,15),t.YNc(34,me,3,3,"th",6),t.YNc(35,pe,2,1,"td",7),t.BQk(),t.YNc(36,de,1,0,"tr",16),t.YNc(37,ge,1,0,"tr",17),t.qZA(),t.qZA(),t._UZ(38,"mat-paginator",18),t.qZA()),2&o&&(t.xp6(2),t.Oqu(t.lcZ(3,7,"Habit.Records")),t.xp6(3),t.s9C("matTooltip",t.lcZ(6,9,"Common.Create")),t.xp6(6),t.Q6J("dataSource",a.arRecords),t.xp6(25),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(1),t.Q6J("length",a.recordCount)("pageSize",20))},directives:[R.Ye,D.lW,Y.gM,Q.Hw,u.BZ,y.YE,u.w1,u.fO,u.Dz,u.as,u.nj,M.NW,u.ge,u.ev,y.nU,u.XQ,u.Gk],pipes:[H.Ot],styles:[".example-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.table-container[_ngcontent-%COMP%]{position:relative;min-height:400px;overflow:auto}table[_ngcontent-%COMP%]{width:100%;height:100%}"]}),e})();function Ce(e,i){if(1&e&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.targetUser),t.xp6(1),t.Oqu(o.displayAs)}}let rt=(()=>{class e{constructor(o,a,r,l){this._formBuilder=o,this.activateRoute=a,this.uiUtilSrv=r,this.odataSrv=l,this.uiMode=f.sk.Create,this.currentMode="Common.Display",this.currentObject=null,this.detailFormGroup=this._formBuilder.group({targetuserCtrl:new n.NI("",n.kI.required),habitIDCtrl:new n.NI(-1),dateCtrl:new n.NI(q()(),n.kI.required),subIDCtrl:new n.NI(1,n.kI.required),compFactCtrl:new n.NI(1,n.kI.required),commentCtrl:new n.NI("")})}get arTargetUsers(){return this.odataSrv.currentUserDetail?this.odataSrv.currentUserDetail.awardUsers:[]}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}get isDisplayMode(){return this.uiMode===f.sk.Display}get isCreateMode(){return this.uiMode===f.sk.Create}get isUpdateMode(){return this.uiMode===f.sk.Update}get isEditable(){return this.uiMode===f.sk.Create||this.uiMode===f.sk.Update}ngOnInit(){this.activateRoute.url.subscribe({next:o=>{var a,r,l,p,d,m;o instanceof Array&&o.length>0&&("record"===o[0].path&&"display"===o[1].path?(this.uiMode=f.sk.Display,this.currentMode="Common.Display"):"record"===o[0].path&&"edit"===o[1].path&&(this.uiMode=f.sk.Update,this.currentMode="Common.Change")),this.uiUtilSrv.currentUserHabitRecord?(null===(a=this.detailFormGroup.get("targetuserCtrl"))||void 0===a||a.setValue(this.uiUtilSrv.currentUserHabitRecord.targetUser),null===(r=this.detailFormGroup.get("habitIDCtrl"))||void 0===r||r.setValue(this.uiUtilSrv.currentUserHabitRecord.habitID),null===(l=this.detailFormGroup.get("dateCtrl"))||void 0===l||l.setValue(this.uiUtilSrv.currentUserHabitRecord.recordDate),null===(p=this.detailFormGroup.get("subIDCtrl"))||void 0===p||p.setValue(this.uiUtilSrv.currentUserHabitRecord.subID),null===(d=this.detailFormGroup.get("compFactCtrl"))||void 0===d||d.setValue(this.uiUtilSrv.currentUserHabitRecord.completeFact),null===(m=this.detailFormGroup.get("commentCtrl"))||void 0===m||m.setValue(this.uiUtilSrv.currentUserHabitRecord.comment),this.uiMode===f.sk.Display?this.detailFormGroup.disable():this.detailFormGroup.enable(),this.uiUtilSrv.clearHabitRecordDisplay()):(this.uiMode=f.sk.Invalid,this.detailFormGroup.disable())},error:o=>{this.uiUtilSrv.showSnackInfo(o)}})}onOK(){}onReturnToList(){this.uiUtilSrv.navigateHabitRecordListPage()}onCreateNewOne(){this.detailFormGroup.reset()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(n.qu),t.Y36(I.gz),t.Y36(b.dM),t.Y36(b.CB))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-record-detail"]],decls:59,vars:42,consts:[[3,"formGroup"],["appearance","fill",1,"control-full-width"],["required","","formControlName","targetuserCtrl"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","formControlName","habitIDCtrl"],["appearance","fill"],["matInput","","formControlName","dateCtrl",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],["matInput","","type","number","formControlName","subIDCtrl"],["matInput","","type","number","formControlName","compFactCtrl"],["matInput","","type","string","formControlName","commentCtrl"],["mat-button","","color","primary",3,"disabled","click"],["mat-button","",3,"click"],["mat-button","",3,"disabled","click"],[3,"value"]],template:function(o,a){if(1&o&&(t.TgZ(0,"mat-card"),t.TgZ(1,"mat-card-header"),t.TgZ(2,"mat-card-title"),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"mat-card-subtitle"),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.qZA(),t.TgZ(8,"mat-card-content"),t.TgZ(9,"form",0),t.TgZ(10,"mat-form-field",1),t.TgZ(11,"mat-label"),t._uU(12),t.ALo(13,"transloco"),t.qZA(),t.TgZ(14,"mat-select",2),t.YNc(15,Ce,2,2,"mat-option",3),t.qZA(),t.qZA(),t.TgZ(16,"mat-form-field",1),t.TgZ(17,"mat-label"),t._uU(18,"#"),t.qZA(),t._UZ(19,"input",4),t.qZA(),t.TgZ(20,"mat-form-field",5),t.TgZ(21,"mat-label"),t._uU(22),t.ALo(23,"transloco"),t.qZA(),t._UZ(24,"input",6),t._UZ(25,"mat-datepicker-toggle",7),t._UZ(26,"mat-datepicker",null,8),t.qZA(),t.TgZ(28,"mat-form-field",1),t.TgZ(29,"mat-label"),t._uU(30),t.ALo(31,"transloco"),t.qZA(),t._UZ(32,"input",9),t.TgZ(33,"mat-hint"),t._uU(34),t.ALo(35,"transloco"),t.qZA(),t.qZA(),t.TgZ(36,"mat-form-field",1),t.TgZ(37,"mat-label"),t._uU(38),t.ALo(39,"transloco"),t.qZA(),t._UZ(40,"input",10),t.TgZ(41,"mat-hint"),t._uU(42),t.ALo(43,"transloco"),t.qZA(),t.qZA(),t.TgZ(44,"mat-form-field",1),t.TgZ(45,"mat-label"),t._uU(46),t.ALo(47,"transloco"),t.qZA(),t._UZ(48,"input",11),t.qZA(),t.qZA(),t.qZA(),t.TgZ(49,"mat-card-actions"),t.TgZ(50,"button",12),t.NdJ("click",function(){return a.onOK()}),t._uU(51),t.ALo(52,"transloco"),t.qZA(),t.TgZ(53,"button",13),t.NdJ("click",function(){return a.onReturnToList()}),t._uU(54),t.ALo(55,"transloco"),t.qZA(),t.TgZ(56,"button",14),t.NdJ("click",function(){return a.onCreateNewOne()}),t._uU(57),t.ALo(58,"transloco"),t.qZA(),t.qZA(),t.qZA()),2&o){const r=t.MAs(27);t.xp6(3),t.Oqu(t.lcZ(4,18,"Habit.Record")),t.xp6(3),t.Oqu(t.lcZ(7,20,a.currentMode)),t.xp6(3),t.Q6J("formGroup",a.detailFormGroup),t.xp6(3),t.Oqu(t.lcZ(13,22,"Award.TargetUser")),t.xp6(3),t.Q6J("ngForOf",a.arTargetUsers),t.xp6(7),t.Oqu(t.lcZ(23,24,"Quiz.Date")),t.xp6(2),t.Q6J("matDatepicker",r),t.xp6(1),t.Q6J("for",r),t.xp6(5),t.Oqu(t.lcZ(31,26,"Habit.SubID")),t.xp6(4),t.Oqu(t.lcZ(35,28,"Habit.SubIDHint")),t.xp6(4),t.Oqu(t.lcZ(39,30,"Habit.CompleteFact")),t.xp6(4),t.Oqu(t.lcZ(43,32,"Habit.CompleteFactHint")),t.xp6(4),t.Oqu(t.lcZ(47,34,"Common.Comment")),t.xp6(4),t.Q6J("disabled",!(a.isEditable&&a.detailFormGroup.valid)),t.xp6(1),t.Oqu(t.lcZ(52,36,"Save")),t.xp6(3),t.Oqu(t.lcZ(55,38,"Common.ReturnToList")),t.xp6(2),t.Q6J("disabled",!a.isDisplayMode),t.xp6(1),t.Oqu(t.lcZ(58,40,"Common.CreateAnotherOne"))}},directives:[T.a8,T.dk,T.n5,T.$j,T.dn,n._Y,n.JL,n.sg,C.KE,C.hX,O.gD,n.Q7,n.JJ,n.u,A.sg,k.Nt,n.wV,n.Fj,h.hl,h.nW,C.R9,h.Mq,C.bx,T.hq,D.lW,N.ey],pipes:[H.Ot],styles:[""]}),e})();var nt=s(5758),he=s(7539);function fe(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Habit.PickAnUser"))}function Ze(e,i){if(1&e&&(t.TgZ(0,"mat-option",27),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.targetUser),t.xp6(1),t.Oqu(o.displayAs)}}function _e(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Habit.AvailableHabits"))}function be(e,i){1&e&&(t.TgZ(0,"th",28),t._uU(1,"ID"),t.qZA())}function Te(e,i){if(1&e&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.HabitID)}}function Ae(e,i){1&e&&(t.TgZ(0,"th",28),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Name")))}function qe(e,i){if(1&e&&(t.TgZ(0,"td",29),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Oqu(o.HabitName)}}function ve(e,i){1&e&&(t.TgZ(0,"th",28),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Habit.Frequency")))}function Ue(e,i){if(1&e&&(t.TgZ(0,"td",29),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,a.getHabitFrequencyName(o.Frequency)))}}function He(e,i){1&e&&(t.TgZ(0,"th",28),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Habit.CompleteCategory")))}function xe(e,i){if(1&e&&(t.TgZ(0,"td",29),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e){const o=i.$implicit,a=t.oxw();t.xp6(1),t.Oqu(t.lcZ(2,1,a.getHabitCompleteCategoryName(o.CompleteCategory)))}}function De(e,i){1&e&&(t.TgZ(0,"th",28),t._uU(1,"COMPLETE FACT"),t.qZA())}function ye(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"mat-checkbox",33),t.NdJ("ngModelChange",function(r){return t.CHM(o),t.oxw().$implicit.CompleteFact=r}),t.qZA(),t.qZA()}if(2&e){const o=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",o.CompleteFact)}}function Oe(e,i){if(1&e){const o=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"mat-form-field"),t.TgZ(2,"input",34),t.NdJ("ngModelChange",function(r){return t.CHM(o),t.oxw().$implicit.CompleteFact=r}),t.ALo(3,"transloco"),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=t.oxw().$implicit;t.xp6(2),t.s9C("placeholder",t.lcZ(3,2,"Value")),t.Q6J("ngModel",o.CompleteFact)}}function Ne(e,i){1&e&&(t.TgZ(0,"div"),t._uU(1,"Nothing display"),t.qZA())}function we(e,i){if(1&e&&(t.TgZ(0,"td",29),t.TgZ(1,"div",30),t.YNc(2,ye,2,1,"div",31),t.YNc(3,Oe,4,4,"div",31),t.YNc(4,Ne,2,0,"div",32),t.qZA(),t.qZA()),2&e){const o=i.$implicit;t.xp6(1),t.Q6J("ngSwitch",o.completeCategoryString),t.xp6(1),t.Q6J("ngSwitchCase",0),t.xp6(1),t.Q6J("ngSwitchCase",1)}}function Se(e,i){1&e&&t._UZ(0,"tr",35)}function Le(e,i){1&e&&t._UZ(0,"tr",36)}function Re(e,i){1&e&&(t._uU(0),t.ALo(1,"transloco")),2&e&&t.Oqu(t.lcZ(1,1,"Common.Done"))}class ke{constructor(){this.HabitID=void 0,this.HabitName="",this.Frequency=c.Hs.Daily,this.CompleteCategory=c.Kd.NumberOfTimes,this.CompleteFact=null}get completeCategoryString(){return(+this.CompleteCategory).toString()}}let Fe=(()=>{class e{constructor(o,a,r){this._formBuilder=o,this.uiUtilSrv=a,this.odataSrv=r,this.currentObject=null,this.arHabits=[],this.displayedColumns=["hid","name","frequency","compCategory","compFact"],this.firstFormGroup=this._formBuilder.group({targetuserCtrl:new n.NI("",n.kI.required),dateCtrl:new n.NI(q()(),n.kI.required)})}get arTargetUsers(){return this.odataSrv.currentUserDetail?this.odataSrv.currentUserDetail.awardUsers:[]}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}getHabitCompleteCategoryName(o){return(0,c.E0)(o)}getHabitFrequencyName(o){return(0,c.lC)(o)}ngOnInit(){}onUserSelected(){var o,a;let r=null===(o=this.firstFormGroup.get("targetuserCtrl"))||void 0===o?void 0:o.value,l=null===(a=this.firstFormGroup.get("dateCtrl"))||void 0===a?void 0:a.value.format(c.Jt);this.odataSrv.getUserHabits(100,0,void 0,`TargetUser eq '${r}' and ValidFrom le ${l} and ValidTo ge ${l}`).subscribe({next:p=>{this.arHabits=[],p.items.forEach(d=>{let m=new ke;m.HabitID=d.ID,m.HabitName=d.name,m.Frequency=d.frequency,m.CompleteCategory=d.completeCategory,m.CompleteFact=null,this.arHabits.push(m)})},error:p=>{this.uiUtilSrv.showSnackInfo(p,1500)}})}get isHabitStepCompleted(){if(!this.arHabits)return!1;let o=!1;return this.arHabits.forEach(a=>{a.CompleteFact&&(o=!0)}),o}onSaveRecord(){let o=[];this.arHabits.forEach(a=>{var r;if(null!==a.CompleteFact){console.log(`${a.HabitID}, ${a.CompleteFact}`);const l=new c.Dh;l.completeFact=+a.CompleteFact,l.habitID=a.HabitID,l.recordDate=null===(r=this.firstFormGroup.get("dateCtrl"))||void 0===r?void 0:r.value,o.push(this.odataSrv.createUserHabitRecord(l))}}),(0,nt.D)(o).subscribe({next:a=>{console.log(a)},error:a=>{this.uiUtilSrv.showSnackInfo(a,1500)}})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(n.qu),t.Y36(b.dM),t.Y36(b.CB))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-record-create"]],decls:64,vars:35,consts:[[1,"toolbar-spacer"],["linear",""],["stepper",""],[3,"stepControl"],[3,"formGroup"],["matStepLabel",""],["appearance","fill",1,"control-full-width"],["required","","formControlName","targetuserCtrl"],[3,"value",4,"ngFor","ngForOf"],["appearance","fill"],["matInput","","formControlName","dateCtrl",3,"matDatepicker"],["matSuffix","",3,"for"],["picker",""],["mat-button","","color","primary","matStepperNext","",3,"disabled","click"],[3,"completed"],["mat-table","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","hid"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","frequency"],["matColumnDef","compCategory"],["matColumnDef","compFact"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-button","","matStepperPrevious",""],["mat-button","","color","warn",3,"click"],[3,"value"],["mat-header-cell",""],["mat-cell",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"ngModel","ngModelChange"],["matInput","","type","number","name","compfact_num",3,"placeholder","ngModel","ngModelChange"],["mat-header-row",""],["mat-row",""]],template:function(o,a){if(1&o){const r=t.EpF();t.TgZ(0,"mat-toolbar"),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"div",0),t.qZA(),t.TgZ(5,"mat-vertical-stepper",1,2),t.TgZ(7,"mat-step",3),t.TgZ(8,"form",4),t.YNc(9,fe,2,3,"ng-template",5),t.TgZ(10,"mat-form-field",6),t.TgZ(11,"mat-label"),t._uU(12),t.ALo(13,"transloco"),t.qZA(),t.TgZ(14,"mat-select",7),t.YNc(15,Ze,2,2,"mat-option",8),t.qZA(),t.qZA(),t.TgZ(16,"mat-form-field",9),t.TgZ(17,"mat-label"),t._uU(18),t.ALo(19,"transloco"),t.qZA(),t._UZ(20,"input",10),t._UZ(21,"mat-datepicker-toggle",11),t._UZ(22,"mat-datepicker",null,12),t.qZA(),t.qZA(),t.TgZ(24,"div"),t.TgZ(25,"button",13),t.NdJ("click",function(){return a.onUserSelected()}),t._uU(26),t.ALo(27,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(28,"mat-step",14),t.YNc(29,_e,2,3,"ng-template",5),t.TgZ(30,"table",15),t.ynx(31,16),t.YNc(32,be,2,0,"th",17),t.YNc(33,Te,2,1,"td",18),t.BQk(),t.ynx(34,19),t.YNc(35,Ae,3,3,"th",17),t.YNc(36,qe,2,1,"td",18),t.BQk(),t.ynx(37,20),t.YNc(38,ve,3,3,"th",17),t.YNc(39,Ue,3,3,"td",18),t.BQk(),t.ynx(40,21),t.YNc(41,He,3,3,"th",17),t.YNc(42,xe,3,3,"td",18),t.BQk(),t.ynx(43,22),t.YNc(44,De,2,0,"th",17),t.YNc(45,we,5,3,"td",18),t.BQk(),t.YNc(46,Se,1,0,"tr",23),t.YNc(47,Le,1,0,"tr",24),t.qZA(),t.TgZ(48,"div"),t.TgZ(49,"button",25),t._uU(50),t.ALo(51,"transloco"),t.qZA(),t.TgZ(52,"button",13),t.NdJ("click",function(){return a.onSaveRecord()}),t._uU(53),t.ALo(54,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(55,"mat-step"),t.YNc(56,Re,2,3,"ng-template",5),t.TgZ(57,"p"),t._uU(58),t.ALo(59,"transloco"),t.qZA(),t.TgZ(60,"div"),t.TgZ(61,"button",26),t.NdJ("click",function(){return t.CHM(r),t.MAs(6).reset()}),t._uU(62),t.ALo(63,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.qZA()}if(2&o){const r=t.MAs(23);t.xp6(2),t.Oqu(t.lcZ(3,19,"Habit.Records")),t.xp6(5),t.Q6J("stepControl",a.firstFormGroup),t.xp6(1),t.Q6J("formGroup",a.firstFormGroup),t.xp6(4),t.Oqu(t.lcZ(13,21,"Award.TargetUser")),t.xp6(3),t.Q6J("ngForOf",a.arTargetUsers),t.xp6(3),t.Oqu(t.lcZ(19,23,"Quiz.Date")),t.xp6(2),t.Q6J("matDatepicker",r),t.xp6(1),t.Q6J("for",r),t.xp6(4),t.Q6J("disabled",!a.firstFormGroup.valid),t.xp6(1),t.Oqu(t.lcZ(27,25,"Common.Next")),t.xp6(2),t.Q6J("completed",a.isHabitStepCompleted),t.xp6(2),t.Q6J("dataSource",a.arHabits),t.xp6(16),t.Q6J("matHeaderRowDef",a.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",a.displayedColumns),t.xp6(3),t.Oqu(t.lcZ(51,27,"Common.Previous")),t.xp6(2),t.Q6J("disabled",!a.isHabitStepCompleted),t.xp6(1),t.Oqu(t.lcZ(54,29,"Common.Next")),t.xp6(5),t.Oqu(t.lcZ(59,31,"Habit.HabitRecordCreatedInfo")),t.xp6(4),t.Oqu(t.lcZ(63,33,"Common.CreateAnotherOne"))}},directives:[R.Ye,v.Vq,v.C0,n._Y,n.JL,n.sg,v.VY,C.KE,C.hX,O.gD,n.Q7,n.JJ,n.u,A.sg,k.Nt,n.Fj,h.hl,h.nW,C.R9,h.Mq,D.lW,v.Ic,u.BZ,u.w1,u.fO,u.Dz,u.as,u.nj,v.fd,N.ey,u.ge,u.ev,A.RF,A.n9,A.ED,he.oG,n.On,n.wV,u.XQ,u.Gk],pipes:[H.Ot],styles:[".example-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.table-container[_ngcontent-%COMP%]{position:relative;min-height:400px;overflow:auto}table[_ngcontent-%COMP%]{width:100%;height:100%}"]}),e})();function Ie(e,i){if(1&e&&(t.TgZ(0,"mat-option",9),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.targetUser),t.xp6(1),t.Oqu(o.displayAs)}}function Me(e,i){if(1&e&&(t.TgZ(0,"mat-option",15),t._uU(1),t.qZA()),2&e){const o=i.$implicit;t.Q6J("value",o.targetUser),t.xp6(1),t.hij(" ",o.displayAs," ")}}let Je=(()=>{class e{constructor(o,a,r){this.odataSrv=o,this.dialog=a,this.uiUtilSrv=r,this.dataSourceUserDate=[],this.displayedColumns=["targetUser","recordDate","point"],this.dataSourcePoints=[],this.recordCount=0,this.selectedUser=null,this.selectedPeriod="2"}get arTargetUsers(){return this.odataSrv.currentUserDetail?this.odataSrv.currentUserDetail.awardUsers:[]}getUserDisplayAs(o){if(o&&this.odataSrv.currentUserDetail){const a=this.odataSrv.currentUserDetail.awardUsers.findIndex(r=>r.targetUser===o);if(-1!==a)return this.odataSrv.currentUserDetail.awardUsers[a].displayAs}return""}ngOnInit(){this.selectedPeriod="2"}onReportParameterSelectionChange(o){null!==this.selectedUser&&this.refreshData()}refreshData(){this.dataSourcePoints=[],this.dataSourceUserDate=[];let o=q()(),a=q().duration(1,"months").asDays();"1"===this.selectedPeriod&&(a=q().duration(1,"weeks").asDays());let r=o.clone().subtract(a,"days"),l=[];const p=a;for(;a>=0;)l.push(o.clone().subtract(a,"days").format(c.Jt)),a--;let d=`TargetUser eq '${this.selectedUser}' and RecordDate ge ${r.format(c.Jt)} and RecordDate le ${o.format(c.Jt)}`,m=[],Z=[];Z.push(this.odataSrv.getHabitOpeningPointsByUserDate(this.selectedUser,p)),Z.push(this.odataSrv.getHabitPointsByUserDateReport(d)),Z.push(this.odataSrv.getUserOpeningPointReport(this.selectedUser,p)),Z.push(this.odataSrv.getUserHabitPointReports(d)),(0,nt.D)(Z).subscribe({next:_=>{let U=_[0];this.dataSourceUserDate=_[1];let F=_[2];this.dataSourcePoints=_[3];let w=[],S=[],L=[],g=0,J=0,lt=U+F;l.forEach(st=>{let ct=this.dataSourceUserDate.findIndex(P=>P.recordDateString===st);g=-1!==ct?this.dataSourceUserDate[ct].point:0,w.push(g);let ut=this.dataSourcePoints.findIndex(P=>P.recordDateString===st);-1!==ut?J+=this.dataSourcePoints[ut].point:J=0,S.push(J),lt+=g+J,L.push(lt)}),m.push({name:"Points from Habits",type:"bar",emphasis:{focus:"series"},data:w}),m.push({name:"Manual Points",type:"bar",emphasis:{focus:"series"},data:S}),m.push({name:"Total Points",type:"bar",emphasis:{focus:"series"},data:L}),this.chartOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:l}],yAxis:[{type:"value"}],series:m}},error:_=>{this.uiUtilSrv.showSnackInfo(_)}})}onChartClick(o){}onCreatePoint(){this.dialog.open(Ye,{width:"600px",closeOnNavigation:!1,data:new c._Y}).afterClosed().subscribe(a=>{a&&this.odataSrv.createHabitPoint(a).subscribe({next:r=>{},error:r=>{this.uiUtilSrv.showSnackInfo(r)}})})}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(b.CB),t.Y36(x.uw),t.Y36(b.dM))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-points-list"]],decls:27,vars:22,consts:[[1,"toolbar-spacer"],[1,"form-field-item"],["required","",3,"ngModel","ngModelChange","selectionChange"],["value","1"],["value","2"],[1,"form-field-user"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","color","primary",3,"matTooltip","click"],["echarts","",1,"demo-chart",2,"width","100%","height","450px",3,"options","chartClick"],[3,"value"]],template:function(o,a){1&o&&(t.TgZ(0,"mat-toolbar"),t.TgZ(1,"h1"),t._uU(2),t.ALo(3,"transloco"),t.qZA(),t._UZ(4,"div",0),t.TgZ(5,"mat-form-field",1),t.TgZ(6,"mat-label"),t._uU(7),t.ALo(8,"transloco"),t.qZA(),t.TgZ(9,"mat-select",2),t.NdJ("ngModelChange",function(l){return a.selectedPeriod=l})("selectionChange",function(l){return a.onReportParameterSelectionChange(l)}),t.TgZ(10,"mat-option",3),t._uU(11),t.ALo(12,"transloco"),t.qZA(),t.TgZ(13,"mat-option",4),t._uU(14),t.ALo(15,"transloco"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"mat-form-field",5),t.TgZ(17,"mat-label"),t._uU(18),t.ALo(19,"transloco"),t.qZA(),t.TgZ(20,"mat-select",2),t.NdJ("ngModelChange",function(l){return a.selectedUser=l})("selectionChange",function(l){return a.onReportParameterSelectionChange(l)}),t.YNc(21,Ie,2,2,"mat-option",6),t.qZA(),t.qZA(),t.TgZ(22,"button",7),t.NdJ("click",function(){return a.onCreatePoint()}),t.ALo(23,"transloco"),t.TgZ(24,"mat-icon"),t._uU(25,"add_circle"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(26,"div",8),t.NdJ("chartClick",function(l){return a.onChartClick(l)}),t.qZA()),2&o&&(t.xp6(2),t.Oqu(t.lcZ(3,10,"Award.Point")),t.xp6(5),t.Oqu(t.lcZ(8,12,"Habit.Frequency")),t.xp6(2),t.Q6J("ngModel",a.selectedPeriod),t.xp6(2),t.Oqu(t.lcZ(12,14,"Habit.ByWeek")),t.xp6(3),t.Oqu(t.lcZ(15,16,"Habit.ByMonth")),t.xp6(4),t.Oqu(t.lcZ(19,18,"Award.TargetUser")),t.xp6(2),t.Q6J("ngModel",a.selectedUser),t.xp6(1),t.Q6J("ngForOf",a.arTargetUsers),t.xp6(1),t.s9C("matTooltip",t.lcZ(23,20,"Common.Create")),t.xp6(4),t.Q6J("options",a.chartOption))},directives:[R.Ye,C.KE,C.hX,O.gD,n.Q7,n.JJ,n.On,N.ey,A.sg,D.lW,Y.gM,Q.Hw,B._w],pipes:[H.Ot],styles:[".example-container[_ngcontent-%COMP%]{position:relative;min-height:200px}.table-container[_ngcontent-%COMP%]{position:relative;min-height:400px;overflow:auto}table[_ngcontent-%COMP%]{width:100%;height:100%}.form-field-item[_ngcontent-%COMP%]{width:100px}.form-field-user[_ngcontent-%COMP%]{width:200px}"]}),e})(),Ye=(()=>{class e{constructor(o,a,r){this.dialogRef=o,this.oDataSrv=a,this.data=r}onNoClick(){this.dialogRef.close()}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(x.so),t.Y36(b.CB),t.Y36(x.WI))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-habit-point-crtdlg"]],decls:33,vars:21,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"example-form"],["appearance","fill",1,"control-full-width"],["name","targetuser",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["appearance","fill"],["matInput","","name","recorddate",3,"matDatepicker","ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["matInput","","type","number","name","point",3,"ngModel","ngModelChange"],["matInput","","name","comment",3,"ngModel","ngModelChange"],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","",3,"disabled","mat-dialog-close"],[3,"value"]],template:function(o,a){if(1&o&&(t.TgZ(0,"h1",0),t._uU(1,"CREATE INCOMING/OUTGOING POINT"),t.qZA(),t.TgZ(2,"div",1),t.TgZ(3,"form",2),t.TgZ(4,"mat-form-field",3),t.TgZ(5,"mat-label"),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.TgZ(8,"mat-select",4),t.NdJ("ngModelChange",function(l){return a.data.targetUser=l}),t.YNc(9,Me,2,2,"mat-option",5),t.qZA(),t.qZA(),t.TgZ(10,"mat-form-field",6),t.TgZ(11,"mat-label"),t._uU(12),t.ALo(13,"transloco"),t.qZA(),t.TgZ(14,"input",7),t.NdJ("ngModelChange",function(l){return a.data.recordDate=l}),t.qZA(),t._UZ(15,"mat-datepicker-toggle",8),t._UZ(16,"mat-datepicker",null,9),t.qZA(),t.TgZ(18,"mat-form-field",3),t.TgZ(19,"mat-label"),t._uU(20),t.ALo(21,"transloco"),t.qZA(),t.TgZ(22,"input",10),t.NdJ("ngModelChange",function(l){return a.data.point=l}),t.qZA(),t.qZA(),t.TgZ(23,"mat-form-field",3),t.TgZ(24,"mat-label"),t._uU(25),t.ALo(26,"transloco"),t.qZA(),t.TgZ(27,"input",11),t.NdJ("ngModelChange",function(l){return a.data.comment=l}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(28,"div",12),t.TgZ(29,"button",13),t.NdJ("click",function(){return a.onNoClick()}),t._uU(30,"No Thanks"),t.qZA(),t.TgZ(31,"button",14),t._uU(32,"OK"),t.qZA(),t.qZA()),2&o){const r=t.MAs(17);t.xp6(6),t.Oqu(t.lcZ(7,13,"Award.TargetUser")),t.xp6(2),t.Q6J("ngModel",a.data.targetUser),t.xp6(1),t.Q6J("ngForOf",null==a.oDataSrv.currentUserDetail?null:a.oDataSrv.currentUserDetail.awardUsers),t.xp6(3),t.Oqu(t.lcZ(13,15,"Quiz.Date")),t.xp6(2),t.Q6J("matDatepicker",r)("ngModel",a.data.recordDate),t.xp6(1),t.Q6J("for",r),t.xp6(5),t.Oqu(t.lcZ(21,17,"Award.Point")),t.xp6(2),t.Q6J("ngModel",a.data.point),t.xp6(3),t.Oqu(t.lcZ(26,19,"Common.Comment")),t.xp6(2),t.Q6J("ngModel",a.data.comment),t.xp6(4),t.Q6J("disabled",!a.data.isValid)("mat-dialog-close",a.data)}},directives:[x.uh,x.xY,n._Y,n.JL,n.F,C.KE,C.hX,O.gD,n.JJ,n.On,A.sg,k.Nt,h.hl,n.Fj,h.nW,C.R9,h.Mq,n.wV,x.H8,D.lW,x.ZT,N.ey],pipes:[H.Ot],encapsulation:2}),e})();const Qe=[{path:"",component:W},{path:"points",component:Je},{path:"list",component:W},{path:"create",component:zt},{path:"edit/:id",component:tt},{path:"display/:id",component:tt},{path:"record",component:it},{path:"record/list",component:it},{path:"record/create",component:Fe},{path:"record/edit",component:rt},{path:"record/display",component:rt}];let Pe=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[I.Bz.forChild(Qe)],I.Bz]}),e})(),Ge=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[A.ez,n.u5,n.UX,mt.U,H.y4,pt.D,B.Ns,Pe]]}),e})()}}]);